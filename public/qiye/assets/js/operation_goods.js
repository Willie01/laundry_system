var app=angular.module("goodsApp",[]);
app.controller("goodsCtr",["$scope","$http",function($scope,$http){
	var all_url="http://www.tchautchau.cn";
	/*显示所有信息*/
	$scope.show_list=function(){
		$http.get(all_url+"/api/cities/"+0+"/categories/"+0+"/products_cities").success(function(data){			
			$scope.goods_list=data;
		});
	}
	$scope.show_list();
	$scope.stage_city=function(){
		$http({
			method:'GET',
			url:all_url+"/api/cities",
		}).success(function(data){
			$scope.cities_list=data;
		}).error(function(){})	
	}
	$scope.stage_city();
	$scope.goods_sort=function(){
		$http.get(all_url+"/api/categories").success(function(data){
			$scope.sort_list=data;
		});
	}
	$scope.goods_sort();
	/*筛选*/
	$scope.filter_goods=function(){
		var city_id=0,sort_id=0;
		if($(".form-control:first-of-type").val()){
			city_id=parseInt($(".form-control:first-of-type").val());
		}else{}
		if($(".sort_select").val()){
			sort_id=parseInt($(".sort_select").val());
		}else{}
		$http.get(all_url+"/api/cities/"+city_id+"/categories/"+sort_id+"/products_cities").success(function(data){			
			$scope.goods_list=data;
		});
	}
	
	/*显示类型*/
	$scope.show_model=function(){
		$(".model-show").show();
		$(".change_save").hide();
		$(".save").show();
	}
	/*隐藏*/
	$(".model-show").hide();
	$scope.hide_model=function(){
		$(".model-show").hide();
		$scope.product_name='';
		$scope.price='';
		
	}
	/*添加*/
	$scope.add_goods=function(){
		$(".model-show").show();
		$http({
			method:'POST',			
			url:all_url+"/api/products_cities",
			data:$.param({
				product_name:$scope.product_name,
				status:$scope.price,
				category_id:$(".sort").val(),
				city_id:$(".sort_cities").val()
			}),
			headers:{"Content-Type":"application/x-www-form-urlencoded"} 
		}).success(function(data){
			$(".model-show").hide();
			$scope.show_list();
		}).error(function(){
			console.log("错误");
		})
	}
	/*显示某个商品*/
	$scope.edit_goods=function(id){
		$http({
			method:'GET',
			url:all_url+"/api/products/"+id,
		}).success(function(data){
			$(".model-show").show();
			$(".change_save").show();
			$(".save").hide();
			$scope.product_name=data.product_name;
			$scope.price=data.price;
			
		})
		$scope.change_goods=function(){
			$http({
				method:'POST',			
				url:all_url+"/api/update/products/"+id,
				data:$.param({
					product_name:$scope.product_name,
					price:$scope.price
				}),
				headers:{"Content-Type":"application/x-www-form-urlencoded"} 
			}).success(function(data){
				$(".model-show").hide();
				$scope.show_list();
			}).error(function(){
				console.log("错误");
			})
		}

	}
	
	$scope.delete_goods=function(e){
		goods_id=$(e.target).attr("goods_id");
		console.log(goods_id)
		$http({
			method:'POST',
			url:all_url+'/api/delete/products/'+goods_id,
			data:$.param({}),
			headers:{"Content-Type":"application/x-www-form-urlencoded"}
		}).success(function(data){
			goods_id=0;
			$scope.show_list();
		}).error(function(){})
	}
}])