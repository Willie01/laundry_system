var app=angular.module("app_price",[]);
app.controller("priceCtr",["$scope","$http",function($scope,$http){
	var all_url="http://www.tchautchau.cn";
	$scope.show_list=function(){
		$http({
			method:'GET',
			url:all_url+"/api/price_rules",
		}).success(function(data){			
			$scope.price_list=data;
		}).error(function(){})		
	}
	$scope.show_list();
	$scope.stage_city=function(){
		$http({
			method:'GET',
			url:all_url+"/api/cities",
		}).success(function(data){
			$scope.cities_list=data;
		}).error(function(){})	
	}
	$scope.stage_city();
	$scope.goods_sort=function(){
		
		$http.get(all_url+"/api/categories").success(function(data){
			$scope.sort_list=data;
		});
	}
	$scope.goods_sort();
	$scope.search_price=function(){
		var city_id=$(".city_type").val();
		var sort_type=$(".sort_type").val();
		var price_type=$(".price_type").val();
		console.log(city_id+"   "+sort_type+"  "+price_type)
	}
	
	$scope.price_type=function(){
		$http.get(all_url+"/api/price_types").success(function(data){
			$scope.priceType_list=data;
		});
	}
	$scope.price_type();
	/*显示类型*/
	$scope.show_model=function(){
		$(".model-show").show();
		$(".change_save").hide();
		$(".save").show();
	}
	$(".model-show-edit").hide();
	/*隐藏*/
	$scope.hide_model=function(){
		$(".model-show").hide();
		$(".model-show-edit").hide();
		$scope.category_name='';
		$scope.category_status='';
		$scope.category_city='';
	}
	/*添加*/
	$scope.add_price=function(){
		console.log($scope.price_type_id)
		$http({
			method:'POST',			
			url:all_url+"/api/price_rules",
			data:$.param({
				price_type_id:$scope.price_type_id,
				products_id:$scope.product_id,
				city_id:$scope.city_id,
				price:$scope.price
			}),
			headers:{"Content-Type":"application/x-www-form-urlencoded"} 
		}).success(function(data){
			$(".model-show").hide();
			$scope.show_list();
			console.log(data.length)
		}).error(function(){
			console.log("错误");
		})
	}
	/*显示某个品类*/
	$scope.edit_price=function(id){
		$http({
			method:'GET',
			url:all_url+"/api/price_rules/"+id,
		}).success(function(data){
			$(".model-show").show();
			$(".change_save").show();
			$(".save").hide();
			$scope.price_type_name=data[0].price_type_name;
			$scope.product_name=data[0].product_name;
			$scope.price=data[0].price
		})
		$scope.change_price=function(){
			console.log($(".sort").val())
			$http({
				method:'POST',			
				url:all_url+"/api/update/price_rules/"+id,
				data:$.param({					
					price_type_name:$scope.price_type_name,
					product_name:$scope.product_name,
					price:$scope.price
				}),
				headers:{"Content-Type":"application/x-www-form-urlencoded"} 
			}).success(function(data){
				$(".model-show").hide();
				$(".model-show-edit").hide();
				$scope.show_list();
			}).error(function(){
				console.log("错误");
			})
		}
	}
	$scope.delete_price=function(e){
		price_id=$(e.target).attr("price_id");
		console.log(price_id)
		$http({
			method:'POST',
			url:all_url+'/api/delete/price_rules/'+price_id,
			data:$.param({}),
			headers:{"Content-Type":"application/x-www-form-urlencoded"}
		}).success(function(data){
			price_id=0;
			$scope.show_list();
		}).error(function(){})
	}
}])
