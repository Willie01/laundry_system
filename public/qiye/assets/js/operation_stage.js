var app=angular.module("stageApp",[]);
app.controller("stageCtr",["$scope","$http",function($scope,$http){
	var all_url="http://www.tchautchau.cn";
	$scope.show_list=function(){
		$http({
			method:'GET',
			url:all_url+"/api/stations",
		}).success(function(data){
//			$(".model-show").show();
			$scope.stations_list=data;
		}).error(function(){})		
	}
	$scope.show_list();
	/*筛选*/
	$scope.filter_stage=function(){
		var city_id=0;
		if($(".stage_select").val()){
			city_id=$(".stage_select").val()
		}else{}
		console.log(city_id)
		$http({
			method:'GET',
			url:all_url+"/api/cities/"+city_id+"/station_cities",
		}).success(function(data){
			$scope.stations_list=data;
		}).error(function(){})	
	}
	$scope.stage_city=function(){
		$http({
			method:'GET',
			url:all_url+"/api/cities",
		}).success(function(data){
			$scope.cities_list=data;
		}).error(function(){})	
	}
	$scope.stage_city()
	$scope.search_stage=function(){
		chzn-select
	}
	var stations_id=0;
	$scope.modify_stationsInfo=function(e){					/*查看并编辑某个工厂*/
			stations_id=$(e.target).attr("stations_id");
			$(".model-show").show();
			$(".add-submit").hide();
			$(".change-submit").show();
			$http({
				method:'GET',
				url:all_url+"/api/stations/"+stations_id,
			}).success(function(data){
				$(".station_name").val(data.station_name);
				$(".station_address").val(data.address);
				$(".station_status").val(data.status);
			}).error(function(){})
			$scope.change_station=function(){			/*提交编辑后的信息*/
				stations_id=$(e.target).attr("stations_id");
				$http({
					method:'POST',
					url:all_url+'/api/stations/stations/'+stations_id,
					data:$.param({
						id:stations_id,
						station_name:$(".station_name").val(),				
						address:$(".station_address").val(),
						status:$(".station_status").val()
					}),
					headers:{"Content-Type":"application/x-www-form-urlencoded"}
				}).success(function(data){
					 $(".model-show").hide();
					stations_id=0;
					$scope.show_list();
				}).error(function(){})
			}
		}
	$scope.delete_station=function(e){
		stations_id=$(e.target).attr("stations_id");
		$http({
			method:'POST',
			url:all_url+'/api/delete/stations/'+stations_id,
			data:$.param({}),
			headers:{"Content-Type":"application/x-www-form-urlencoded"}
		}).success(function(data){
			stations_id=0;
			$scope.show_list();
		}).error(function(){})
	}
	$scope.hide_model=function(){
		$(".model-show").hide();
	};
	$scope.add_station=function(){
		$(".model-show").show();
		$(".about-stations-body").find("input").val("");
		$(".add-submit").show();
		$(".change-submit").hide();
	}
	$scope.submit_station=function(){
		$http({
			method:'POST',
			url:all_url+'/api/stations',
			data:$.param({
				station_name:$(".station_name").val(),				
				address:$(".station_address").val(),
				status:$(".station_status").val()
			}),
			headers:{"Content-Type":"application/x-www-form-urlencoded"}
		}).success(function(data){
			stations_id=0;
			$scope.hide_model();
			$scope.show_list();
		}).error(function(){})
	}
}])